var custom = {};


custom.SGFS = {
    B: [
        "(;GM[1]FF[4]CA[UTF-8]SZ[19]KM[6.5];B[pd];W[cd];B[pp];W[cp];B[eq];W[do];B[ec];W[de];B[nq];W[qc];B[qd];W[pc];B[od];W[nb];B[qk];W[fp];B[gq];W[io];B[dj];W[cl])",
        "(;GM[1]FF[4]CA[UTF-8]SZ[19]KM[6.5];B[pd];W[cd];B[pp];W[dp];B[ec];W[de];B[cq];W[dq];B[cp];W[cn];B[bn];W[cm];B[bm];W[cl];B[nc];W[qq];B[qp];W[pq];B[nq];W[oq])",
        "(;GM[1]FF[4]CA[UTF-8]SZ[19]KM[6.5];B[pd];W[cd];B[pp];W[dq];B[ed];W[ec];B[fc];W[dc];B[fd];W[cf];B[co];W[qc];B[pc];W[qd];B[qf];W[qe];B[pe];W[rf];B[qb];W[rb])",
        "(;GM[1]FF[4]CA[UTF-8]SZ[19]KM[6.5];B[pd];W[cp];B[pp];W[cd];B[eq];W[do];B[ec];W[de];B[nq];W[qc];B[qd];W[pc];B[od];W[nb];B[qk];W[fp];B[gq];W[io];B[dj];W[cl])",
        "(;GM[1]FF[4]CA[UTF-8]SZ[19]KM[6.5];B[pd];W[cp];B[pp];W[dc];B[ep];W[eq];B[fq];W[dq];B[fp];W[cn];B[ce];W[qq];B[pq];W[qp];B[qn];W[qo];B[po];W[rn];B[qr];W[rr])",
        "(;GM[1]FF[4]CA[UTF-8]SZ[19]KM[6.5];B[pd];W[cp];B[pp];W[dd];B[eq];W[do];B[cc];W[dc];B[cd];W[cf];B[bf];W[cg];B[bg];W[ch];B[nq];W[qc];B[qd];W[pc];B[nc];W[oc])",
        "(;GM[1]FF[4]CA[UTF-8]SZ[19]KM[6.5];B[pd];W[dc];B[dp];W[pp];B[ce];W[ed];B[qq];W[pq];B[qp];W[qn];B[qo];W[po];B[rn];W[qc];B[pc];W[qd];B[qe];W[re];B[rf];W[qf])",
        "(;GM[1]FF[4]CA[UTF-8]SZ[19]KM[6.5];B[pd];W[dc];B[dp];W[pq];B[qo];W[op];B[ce];W[fd];B[qf];W[cn];B[fp];W[ch];B[pl];W[hq];B[jq];W[ho];B[mq];W[jo];B[lo];W[on])",
        "(;GM[1]FF[4]CA[UTF-8]SZ[19]KM[6.5];B[pd];W[dc];B[dp];W[qp];B[oq];W[po];B[ce];W[ed];B[hc];W[nc];B[kc];W[qc];B[pc];W[qd];B[pe];W[pb];B[ob];W[qb];B[oc];W[qf])",
        "(;GM[1]FF[4]CA[UTF-8]SZ[19]KM[6.5];B[pd];W[dd];B[dp];W[pp];B[nq];W[qn];B[pq];W[qq];B[qr];W[oq];B[pr];W[op];B[or];W[qc];B[qd];W[pc];B[nc];W[oc];B[od];W[nb])",
        "(;GM[1]FF[4]CA[UTF-8]SZ[19]KM[6.5];B[pd];W[dd];B[dp];W[pq];B[qo];W[op];B[cc];W[dc];B[cd];W[cf];B[ce];W[de];B[bf];W[cq];B[dq];W[cp];B[co];W[bo];B[bn];W[cn])",
        "(;GM[1]FF[4]CA[UTF-8]SZ[19]KM[6.5];B[pd];W[dp];B[pp];W[cd];B[ec];W[de];B[cq];W[dq];B[cp];W[cn];B[bn];W[cm];B[bm];W[cl];B[nc];W[qq];B[qp];W[pq];B[nq];W[oq])",
        "(;GM[1]FF[4]CA[UTF-8]SZ[19]KM[6.5];B[pd];W[dp];B[pp];W[dc];B[cq];W[cp];B[dq];W[ep];B[fq];W[qc];B[qd];W[pc];B[od];W[nb];B[gr];W[cf];B[cl];W[go];B[ci];W[pi])",
        "(;GM[1]FF[4]CA[UTF-8]SZ[19]KM[6.5];B[pd];W[dp];B[pp];W[dd];B[fc];W[qq];B[pq];W[qp];B[po];W[rn];B[cf];W[ef];B[ci];W[nc];B[db];W[cc];B[hc];W[gd];B[oc];W[gc];B[gb];W[hd];B[ic];W[id];B[ec];W[ed];B[fq];W[jd];B[cn];W[jb];B[nd];W[ha])",
    ],
    W: [
        "(;GM[1]FF[4]CA[UTF-8]SZ[19]KM[6.5];B[pd];W[dp];B[pp];W[dd];B[fc];W[qq];B[pq];W[qp];B[po];W[rn];B[cf];W[ef];B[ci];W[nc];B[db];W[cc];B[hc];W[gd];B[oc];W[gc];B[gb];W[hd];B[ic];W[id];B[ec];W[ed];B[fq];W[jd];B[cn];W[jb];B[nd];W[ha])",
        "(;GM[1]FF[4]CA[UTF-8]SZ[19]KM[6.5];B[pd];W[dp];B[pq];W[dd];B[cq];W[dq];B[cp];W[do];B[bn];W[qc];B[qd];W[pc];B[od];W[nc];B[rc];W[nd];B[qn];W[nf];B[cm];W[iq])",
        "(;GM[1]FF[4]CA[UTF-8]SZ[19]KM[6.5];B[pd];W[dp];B[qp];W[dd];B[cc];W[dc];B[cd];W[de];B[bf];W[qc];B[pc];W[qd];B[pe];W[rf];B[ic];W[oq];B[cg];W[po];B[qo];W[pn])",
        "(;GM[1]FF[4]CA[UTF-8]SZ[19]KM[6.5];B[qd];W[dd];B[cp];W[pp];B[fq];W[oc];B[pf];W[fc];B[nq];W[pn];B[cf];W[oq];B[cd];W[cc];B[bc];W[cb];B[de];W[bd];B[ce];W[bb])",
        "(;GM[1]FF[4]CA[UTF-8]SZ[19]KM[6.5];B[qd];W[dd];B[dp];W[pp];B[nc];W[cq];B[dq];W[cp];B[cn];W[co];B[do];W[bn];B[qn];W[nq];B[fc];W[df];B[qp];W[qq];B[rq];W[qo])",
        "(;GM[1]FF[4]CA[UTF-8]SZ[19]KM[6.5];B[qd];W[dd];B[dq];W[pp];B[dn];W[oc];B[pf];W[fc];B[cf];W[pn];B[cd];W[cc];B[bc];W[cb];B[de];W[bd];B[ce];W[bb];B[di];W[jq])",
        "(;GM[1]FF[4]CA[UTF-8]SZ[19]KM[6.5];B[qd];W[dd];B[pp];W[dp];B[cq];W[dq];B[cp];W[do];B[bn];W[qq];B[pq];W[qp];B[po];W[rn];B[iq];W[oc];B[cm];W[pe];B[qe];W[pf])",
        "(;GM[1]FF[4]CA[UTF-8]SZ[19]KM[6.5];B[qd];W[dd];B[pq];W[dq];B[cc];W[cd];B[dc];W[ed];B[fb];W[oc];B[qn];W[cn];B[pc];W[od];B[pf];W[kd];B[gc];W[di];B[jq];W[hq])",
        "(;GM[1]FF[4]CA[UTF-8]SZ[19]KM[6.5];B[qd];W[dd];B[qp];W[dp];B[cq];W[cp];B[dq];W[ep];B[fq];W[oc];B[gr];W[oq];B[pf];W[fc];B[cj];W[cl];B[cg];W[ce];B[gc];W[gb])",
    ]
}


custom.init = function() {
    custom.colorElement = document.getElementById("color");
    custom.mistakesElement = document.getElementById("mistakes");
    custom.colorSelect = document.getElementById("colorSelect");
    custom.boardElement = document.getElementById("board");

    document.getElementById("newBtn").addEventListener("click", custom.newBtnClickListener);
    document.getElementById("resetBtn").addEventListener("click", custom.resetBtnClickListener);

    custom.newBtnClickListener();
};

custom.newBtnClickListener = function() {
    custom.mistakes = 0;
    custom.mistakesElement.innerHTML = custom.mistakes;

    custom.color = custom.colorSelect.value;
    if (custom.color == "R") {
        custom.color = custom.randomInt(2) == 1 ? "B" : "W";
    }
    custom.colorElement.innerHTML = custom.color;

    let sgf = custom.SGFS[custom.color][custom.randomInt(custom.SGFS[custom.color].length)];
    // let sgf = custom.SGFS.B[0];

    custom.createBoard(sgf);

    // custom.scrambleBoard();

    custom.editor.nextNode(4);
};

custom.resetBtnClickListener = function() {
    custom.mistakes = 0;
    custom.mistakesElement.innerHTML = custom.mistakes;
    custom.editor.prevNode(1000);
};

custom.randomInt = function(max) {
    return Math.floor(Math.random() * max);
};

custom.createBoard = function(sgf) {
    let settings = {
		resize: "auto",
		orient: "portrait",
		panels: "control+tree",
		coord: "western",
        tool: "cross",
		variants: 2,
		nowheel: true,
	};

    if (sgf) {
        settings.sgf = sgf;
    }

    besogo.create(custom.boardElement, settings);

    custom.editor = custom.boardElement.besogoEditor;

    custom.editor.addListener(custom.editorListener);
};

custom.editorListener = function(event) {
    if (event.markupChange) {
        custom.removeMarkup(event);

        let nextNode = custom.editor.getCurrent().children[0];
        if (!nextNode) return;

        if (nextNode.move.x != event.x || nextNode.move.y != event.y) {
            custom.mistakes++;
            custom.mistakesElement.innerHTML = custom.mistakes;
        }

        custom.editor.nextNode(1);
    }
};

custom.removeMarkup = function(coord) {
    custom.editor.getCurrent().markup[(coord.x - 1) * 19 + (coord.y - 1)] = 0;
};

custom.placeStone = function(x, y) {
    custom.editor.setTool("auto");
    custom.editor.click(x, y, false);
    custom.editor.setTool("cross");
};

custom.scrambleBoard = function() {
    let rotateCount = custom.randomInt(4);
    for (let i=0; i<rotateCount; i++) {
        custom.rotateBoard();
    }

    if (custom.randomInt(2) == 1) {
        custom.flipBoard();
    }
};

custom.rotateBoard = function() {
    let newCoords = [];

    let node = custom.editor.getRoot();
    while (node) {
        if (node.move) {
            let x = node.move.y;
            let y = 20 - node.move.x;

            newCoords.push({x: x, y: y});
        }

        node = node.children[0];
    }

    custom.createBoard();

    newCoords.forEach(coord => {
        custom.placeStone(coord.x, coord.y);
    });

    custom.editor.prevNode(1000);
};

custom.flipBoard = function() {
    let newCoords = [];

    let node = custom.editor.getRoot();
    while (node) {
        if (node.move) {
            let x = node.move.x;
            let y = 20 - node.move.y;

            newCoords.push({x: x, y: y});
        }

        node = node.children[0];
    }

    custom.createBoard();

    newCoords.forEach(coord => {
        custom.placeStone(coord.x, coord.y);
    });

    custom.editor.prevNode(1000);
};